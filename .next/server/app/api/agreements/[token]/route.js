(()=>{var e={};e.id=975,e.ids=[975],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},89208:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{GET:()=>p});var a=r(42706),s=r(28203),i=r(45994),o=r(39187),l=r(71618);async function p(e,{params:t}){try{let{token:e}=await t,r=await l.z.agreement.findUnique({where:{uniqueToken:e},include:{client:!0,template:!0,fields:!0}});if(!r)return o.NextResponse.json({error:"Agreement not found"},{status:404});if(r.expiresAt&&new Date(r.expiresAt)<new Date)return o.NextResponse.json({error:"Agreement has expired"},{status:410});let n=r.template.htmlContent;return n=(n=(n=(n=(n=n.replace(/\{\{client\.firstName\}\}/g,r.client.firstName)).replace(/\{\{client\.lastName\}\}/g,r.client.lastName)).replace(/\{\{client\.email\}\}/g,r.client.email)).replace(/\{\{client\.phone\}\}/g,r.client.phone||"")).replace(/\{\{client\.eventDate\}\}/g,r.client.eventDate?new Date(r.client.eventDate).toLocaleDateString():""),r.fields.forEach(e=>{let t=RegExp(`\\{\\{${e.key}\\}\\}`,"g");n=n.replace(t,e.value)}),await l.z.agreement.update({where:{id:r.id},data:{mergedHtml:n}}),o.NextResponse.json({id:r.id,client:r.client,template:r.template,status:r.status,mergedHtml:n,fields:r.fields})}catch(e){return console.error("Error fetching agreement:",e),o.NextResponse.json({error:"Failed to fetch agreement"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/agreements/[token]/route",pathname:"/api/agreements/[token]",filename:"route",bundlePath:"app/api/agreements/[token]/route"},resolvedPagePath:"C:\\Users\\denni\\agreements\\app\\api\\agreements\\[token]\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:c,workUnitAsyncStorage:d,serverHooks:m}=u;function g(){return(0,i.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:d})}},96487:()=>{},78335:()=>{},71618:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});let n=require("@prisma/client"),a=global.prisma||new n.PrismaClient({log:["error","warn"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,452],()=>r(89208));module.exports=n})();