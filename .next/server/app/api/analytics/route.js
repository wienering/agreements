(()=>{var e={};e.id=70,e.ids=[70],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},96869:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>c});var n=r(42706),s=r(28203),o=r(45994),i=r(39187),u=r(71618);async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("days"),[a,n,s,o,c,l,d]=await Promise.all([u.z.agreement.count(),u.z.client.count(),u.z.template.count(),u.z.agreement.count({where:{status:"DRAFT"}}),u.z.agreement.count({where:{status:"LIVE"}}),u.z.agreement.count({where:{status:"SIGNED"}}),u.z.agreement.count({where:{status:"COMPLETED"}})]),p=a>0?Math.round(l/a*100):0,g=new Date;g.setDate(g.getDate()-30);let m=await u.z.agreement.findMany({where:{createdAt:{gte:g}},include:{client:!0,template:!0},orderBy:{createdAt:"desc"},take:10}),h=new Date;h.setMonth(h.getMonth()-6);let w=await u.z.agreement.groupBy({by:["createdAt"],where:{createdAt:{gte:h}},_count:{id:!0}}),y=Array.from({length:6},(e,t)=>{let r=new Date;r.setMonth(r.getMonth()-(5-t));let a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,n=w.filter(e=>{let t=new Date(e.createdAt);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`===a});return{month:r.toLocaleDateString("en-US",{month:"short",year:"numeric"}),count:n.reduce((e,t)=>e+t._count.id,0)}}),x=await u.z.client.findMany({include:{_count:{select:{agreements:!0}}},orderBy:{agreements:{_count:"desc"}},take:5}),v=await u.z.template.findMany({include:{_count:{select:{agreements:!0}}},orderBy:{agreements:{_count:"desc"}}});if(r)return i.NextResponse.json({overview:{totalAgreements:a,totalClients:n,totalTemplates:s,signedAgreements:l,draftAgreements:o,sentAgreements:c,conversionRate:p}});let f={overview:{totalAgreements:a,totalClients:n,totalTemplates:s,statusDistribution:[{status:"DRAFT",count:o,color:"#dc2626"},{status:"LIVE",count:c,color:"#059669"},{status:"SIGNED",count:l,color:"#2563eb"},{status:"COMPLETED",count:d,color:"#7c3aed"}]},recentActivity:m,monthlyStats:y,topClients:x.map(e=>({id:e.id,name:`${e.firstName} ${e.lastName}`,email:e.email,agreementCount:e._count.agreements})),templateUsage:v.map(e=>({id:e.id,title:e.title,usageCount:e._count.agreements}))};return i.NextResponse.json(f)}catch(e){return console.error("Error fetching analytics:",e),i.NextResponse.json({error:"Failed to fetch analytics"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\denni\\agreements\\app\\api\\analytics\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:g}=l;function m(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}},96487:()=>{},78335:()=>{},71618:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,452],()=>r(96869));module.exports=a})();